<!-- templates/train_supervised.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ML Training & Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- TailwindCSS (inline CDN for brevity) -------------------------------------------------->
  <script src="https://cdn.tailwindcss.com"></script>
      <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
	        .section-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #004466;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
	        header {
            background-color: #2c2c2c;
            padding: 1rem 2rem;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

            header img {
                height: 60px;
                vertical-align: middle;
            }

            header h1 {
                margin-left: 1rem;
                font-size: 1.5rem;
            }
        nav.main-nav ul {
            list-style: none;
            display: flex;
            gap: 1.5rem;
            margin: 0;
            padding: 0;
        }

            nav.main-nav ul li {
                display: inline;
            }

        nav.main-nav a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
        }

            nav.main-nav a:hover {
                text-decoration: underline;
            }
    </style>	
	
	
	
</head>
<body class="min-h-screen bg-gray-50 text-gray-800">
  <!-- ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Header / Nav ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
    <header>
        <div style="display: flex; align-items: center;">
            <img src="{{ url_for('static', filename='logo.webp') }}" alt="KOI Logo">
            <h1>Next Gen-IDS</h1>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="{{ url_for('home.index') }}">üè† Home</a></li>
                <li><a href="{{ url_for('dashboard.view') }}">üìä Analytics Dashboard</a></li>
				<li><a href="{{ url_for('alerts.alert_dashboard') }}">ü§ñ Alert Dashboard </a></li>
                <li><a href="{{ url_for('train_supervised.train_supervised_model') }}">ü§ñ Train Suppervised Model</a></li>
				<li><a href="{{ url_for('train_unsupervised.train_unsupervised_model') }}">ü§ñ Train Unsuppervised Model</a></li>
                {% if g.user is not none and g.user.role == 'admin' %}
                <li><a href="{{ url_for('admin.user_mgmt') }}">üßë‚Äçüíº Admin Panel</a></li>
                {% endif %}
                <li><a href="{{ url_for('auth.logout') }}">üö™ Logout</a></li>
            </ul>
        </nav>
    </header>
  <!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

  <main class="pt-24 pb-16 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-12">
    <!-- Training Card ------------------------------------------------->
    <section id="train-card" class="bg-white shadow rounded-2xl p-8">
      <h2 class="text-2xl font-semibold mb-6 flex items-center gap-2">ü§ñ Train Supervised Model</h2>
      <form method="post" action="{{ url_for('train_supervised.train_supervised_model') }}" enctype="multipart/form-data" class="grid lg:grid-cols-3 gap-6">
        <div class="space-y-4 lg:col-span-2">
          <label class="block">
            <span class="font-medium">Choose CSV (optional)</span>
            <input type="file" name="csv_file" accept=".csv" class="mt-1 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" />
          </label>
          <label class="block">
            <span class="font-medium">Model Type</span>
            <select name="model_type" required class="mt-1 w-full rounded border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
              <option value="DecisionTree">Decision Tree</option>
              <option value="RandomForest">Random Forest</option>
              <option value="LinearSVM">Linear SVM</option>
            </select>
          </label>
        </div>
        <div class="flex items-end lg:justify-end">
          <button type="submit" class="w-full lg:w-auto inline-flex justify-center items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl font-semibold shadow hover:bg-indigo-700 transition">Train Model</button>
        </div>
      </form>
    </section>

    <!-- Prediction Card ---------------------------------------------->
    <section id="predict-card" class="bg-white shadow rounded-2xl p-8">
      <h2 class="text-2xl font-semibold mb-6 flex items-center gap-2">üßÆ Quick Prediction</h2>
      <form method="post" action="{{ url_for('train_supervised.predict_url_type') }}" class="grid lg:grid-cols-3 gap-6">
        <div class="space-y-4 lg:col-span-2">
          <label class="block">
            <span class="font-medium">Paste URL / Text</span>
            <input type="text" name="url" placeholder="https://example.com/" required class="mt-1 w-full rounded border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" />
          </label>
          <label class="block">
            <span class="font-medium">Model</span>
            <select name="model_type" required class="mt-1 w-full rounded border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
              {% for m in models or ['DecisionTree','RandomForest','LinearSVM'] %}
                <option value="{{ m }}">{{ m }}</option>
              {% endfor %}
            </select>
          </label>
        </div>
        <div class="flex items-end lg:justify-end">
          <button type="submit" class="w-full lg:w-auto inline-flex justify-center items-center gap-2 px-6 py-3 bg-teal-600 text-white rounded-xl font-semibold shadow hover:bg-teal-700 transition">Predict</button>
        </div>
      </form>

      {% if prediction %}
      <div class="mt-8">
        <h3 class="text-lg font-medium">Prediction: <span class="text-indigo-600 font-bold">{{ prediction }}</span></h3>
        <ul class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 text-sm">
          {% for cls, p in proba.items() %}
            <li class="bg-gray-100 rounded-lg p-3 flex justify-between"><span>{{ cls }}</span><span class="font-semibold">{{ p }}</span></li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </section>

    <!-- Recent Metrics ----------------------------------------------->
    <section id="metrics-card" class="bg-white shadow rounded-2xl p-8">
      <h2 class="text-2xl font-semibold mb-6 flex items-center gap-2">üìà Recent Metrics</h2>
      {% if recent_images %}
      <!-- 2‚Äëup responsive grid (always 2 per row) -->
      <div class="grid gap-8 sm:grid-cols-2">
        {% for img in recent_images %}
          <a href="{{ url_for('static', filename='training_results/supervised/' + img) }}" target="_blank" class="group block rounded-xl overflow-hidden shadow hover:shadow-xl transition transform hover:-translate-y-1">
            <div class="aspect-video bg-gray-50 flex items-center justify-center">
              <img src="{{ url_for('static', filename='training_results/supervised/' + img) }}" alt="{{ img }}" class="w-full h-full object-contain" />
            </div>
            <!-- subtle overlay caption -->
            <div class="opacity-0 group-hover:opacity-100 absolute inset-0 bg-black/50 flex items-center justify-center text-white text-sm font-medium transition">
              Click to open full size
            </div>
          </a>
        {% endfor %}
      </div>
      {% else %}
        <p class="text-gray-500">No training results yet. Train a model to see metrics here.</p>
      {% endif %}
    </section>
  </main>

  <!-- Flash messages ------------------------------------------------->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="fixed bottom-5 right-5 space-y-3 z-50">
        {% for category, msg in messages %}
          <div class="px-4 py-3 rounded-lg shadow-lg text-sm text-white {{ 'bg-red-600' if category=='error' else 'bg-indigo-600' }}">
            {{ msg }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
</body>
</html>
